<!DOCTYPE html>
<html lang="zh">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="keywords"
          content="admin, dashboard, bootstrap, template, flat, modern, theme, responsive, fluid, retina, backend, html5, css, css3">
    <meta name="description" content="">
    <meta name="author" content="ThemeBucket">

    <title>辽科大疫情防控平台</title>
    <link rel="shortcut icon" href="../../img/logo.ico"/>

    <!--dashboard calendar不重要-->
    <link href="../../css/clndr.css" rel="stylesheet">

    <!--Morris Chart CSS 不重要-->
    <link rel="stylesheet" href="../../js/morris-chart/morris.css">

    <!--common重要-->
    <link href="../../css/style_user.css" rel="stylesheet">
    <!-- 不重要 -->
    <link href="../../css/style-responsive.css" rel="stylesheet">

</head>

<body class="sticky-header">

<section>

    <div class="left-side sticky-left-side">

        <!--logo and iconic logo 开始-->
        <div class="logo">
            <a href="/user/toIndex_user"><img src="../../images/logo.png" alt=""></a>
        </div>

        <div class="logo-icon text-center">
            <a href="/user/toIndex_user"><img src="../../images/logo_icon.png" alt=""></a>
        </div>
        <!--logo and iconic logo 结束-->

        <!--左侧导航栏开始-->
        <div class="left-side-inner">

            <ul class="nav nav-pills nav-stacked custom-nav">
                <li><a href="/user/toIndex_epc"><i class="fa fa-home"></i> <span>主页</span></a></li>
                <li class="active"><a href="/user/toEpc_signIn"><i class="fa fa-laptop"></i> <span> 今日打卡</span></a>
                </li>
                <li class="menu-list"><a href=""><i class="fa fa-book"></i> <span>情况报备</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="/user/toEpc_applyForCon"> 访客出入报备</a></li>
                        <li><a href="/user/toEpc_applyForSpecialCon"> 特殊事项报备</a></li>
                    </ul>
                </li>

                <li><a href="/user/toEpc_message"><i class="fa fa-envelope"></i> <span>留言</span></a>
                </li>

                <li class="menu-list"><a href=""><i class="fa fa-cogs"></i> <span>账号管理</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="/user/toEpc_info"> 个人信息管理</a></li>
                        <li><a href="/user/toEpc_repass"> 修改密码</a></li>
                    </ul>
                </li>

            </ul>


        </div>
    </div>
    <!--左侧导航栏结束-->
    </div>


    <!-- 主体开始：除去左侧导航栏所有-->
    <div class="main-content">

        <!-- 上方导航栏开始 -->
        <div class="header-section">


            <!--左侧导航栏伸展开始-->
            <a class="toggle-btn"><i class="fa fa-bars"></i></a>
            <!--左侧导航栏伸展结束-->

            <!--搜索框开始 action中跳转地址！-->
            <form class="searchform" action="index.html" method="post">
                <input type="text" class="form-control" name="keyword" placeholder="Search here..."/>
            </form>
            <!--搜索框结束-->

            <!-- 上方导航栏右侧通知 + 人物 开始-->
            <div class="menu-right">
                <ul class="notification-menu">
                    <!-- 上侧导航栏task开始 -->
                    <li>
                        <a href="#" class="btn btn-default dropdown-toggle info-number" data-toggle="dropdown">
                            <i class="fa fa-tasks"></i>
                            <span class="badge">1</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-head pull-right">
                            <h5 class="title">你有 1 个挂起任务</h5>
                            <ul class="dropdown-list user-list">
                                <li class="new">
                                    <a href="#">
                                        <div class="task-info">
                                            <div>Database update</div>
                                        </div>
                                        <div class="progress progress-striped">
                                            <div style="width: 40%" aria-valuemax="100" aria-valuemin="0"
                                                 aria-valuenow="40" role="progressbar"
                                                 class="progress-bar progress-bar-warning">
                                                <span class="">40%</span>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="new"><a href="">查看所有任务</a></li>
                            </ul>
                        </div>
                    </li>
                    <!-- 上侧导航栏task结束 -->

                    <!-- 上方导航栏Email开始 -->
                    <li>
                        <a href="#" class="btn btn-default dropdown-toggle info-number" data-toggle="dropdown">
                            <i class="fa fa-envelope-o"></i>
                            <span class="badge">1</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-head pull-right">
                            <h5 class="title">您有 1 封邮件 </h5>
                            <ul class="dropdown-list normal-list">
                                <li class="new">
                                    <a href="">
                                        <span class="thumb"><img src="../../images/photos/user1.png" alt=""/></span>
                                        <span class="desc">
                                          <span class="name">John Doe <span
                                                  class="badge badge-success">new</span></span>
                                          <span class="msg">Lorem ipsum dolor sit amet...</span>
                                        </span>
                                    </a>
                                </li>

                            </ul>
                        </div>
                    </li>
                    <!-- 上方导航栏Email结束 -->

                    <!-- 上方导航栏铃铛提醒开始 -->
                    <li>
                        <a href="#" class="btn btn-default dropdown-toggle info-number" data-toggle="dropdown">
                            <i class="fa fa-bell-o"></i>
                            <span class="badge">1</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-head pull-right">
                            <h5 class="title">注意事项</h5>
                            <ul class="dropdown-list normal-list">
                                <li class="new">
                                    <a href="">
                                        <span class="label label-danger"><i class="fa fa-bolt"></i></span>
                                        <span class="name">Server #1 overloaded.  </span>
                                        <em class="small">34 mins</em>
                                    </a>
                                </li>

                                <li class="new"><a href="">查看所有注意事项</a></li>
                            </ul>
                        </div>
                    </li>
                    <!-- 上方导航栏铃铛提醒结束 -->

                    <!-- 上方导航栏User开始 -->
                    <li id="login_user">
                        <a href="/user/toLogin" class="btn btn-default dropdown-toggle">
                            登&nbsp;&nbsp;录
                            <span class="glyphicon glyphicon-new-window"></span>
                        </a>
                    </li>
                    <!-- 上方导航栏User结束 -->

                </ul>
            </div>
            <!--上方导航栏右侧通知 + 人物结束 -->
        </div>
        <!-- 上方导航栏结束-->


        <!-- 页面内容开始-->
        <!-- 主体头部开始 -->
        <div class="page-heading" id="main">
            <section class="panel">
                <header class="panel-heading">
                    今日打卡
                </header>
                <div class="panel-body" id="mainSignIn">
                    <form class="form-horizontal adminex-form" method="get" onsubmit="return false;">
                        <div class="form-group">
                            <label class="col-sm-2 col-sm-2 control-label">姓名</label>
                            <div class="col-sm-5">
                                <input type="text" class="form-control round-input" disabled id="username_1">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 col-sm-2 control-label">请填写您的体温&nbsp;<span
                                    style="color: #ff0000">*</span></label>
                            <div class="col-sm-5" id="temp">
                                <input type="text" class="form-control round-input" id="temperature">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 col-sm-2 control-label">您是否有以下症状&nbsp;<span
                                    style="color: #ff0000">*</span></label>
                            <div class="col-sm-5">


                                <div><input type="checkbox" value="没有出现症状" id="status_0">
                                    <label for="status_0">没有出现症状</label></div>

                                <div><input type="checkbox" value="感冒样症状：乏力、咳嗽、发烧、肌肉痛、头痛" id="status_1">
                                    <label for="status_1"> 感冒样症状：乏力、咳嗽、发烧、肌肉痛、头痛</label></div>

                                <div><input type="checkbox" value="喘憋、呼吸急促" id="status_2">
                                    <label for="status_2">喘憋、呼吸急促</label></div>

                                <div><input type="checkbox" value="心慌、胸闷" id="status_3">
                                    <label for="status_3">心慌、胸闷</label></div>

                                <div><input type="checkbox" value="恶心呕吐、腹泻" id="status_4">
                                    <label for="status_4">恶心呕吐、腹泻</label></div>

                                <div><input type="checkbox" value="结膜炎（红眼病样症状表现：眼睛涩、红、有分泌物）" id="status_5">
                                    <label for="status_5"> 结膜炎（红眼病样症状表现：眼睛涩、红、有分泌物）</label></div>

                                <div><input type="checkbox" value="其他症状" id="status_6">
                                    <label for="status_6">其他症状</label></div>

                            </div>

                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 col-sm-2 control-label"> 近两周是否接触新冠患者&nbsp;<span
                                    style="color: #ff0000">*</span></label>
                            <div class="col-sm-5">
                                <div><input type="radio" value="有" id="radio_status1" name="radio">
                                    <label for="radio_status1">有</label></div>
                                <div><input type="radio" value="无" id="radio_status2" name="radio">
                                    <label for="radio_status2">无</label></div>
                                <div><input type="radio" value="不确定" id="radio_status3" name="radio">
                                    <label for="radio_status3">不确定</label></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 col-sm-2 control-label">请填写您当前所在地址(精确到市)&nbsp;<span
                                    style="color: #ff0000">*</span></label>
                            <div class="col-sm-5" id="loc_div">
                                <input type="text" class="form-control round-input" id="loc">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 col-sm-2 control-label"> &nbsp;</label>
                            <div class="col-sm-5">
                                <input type="checkbox" id="fuze">
                                <label for="fuze">【上述信息是我本人填写，本人对信息内容的真实性和完整性负责】 </label>
                                <div>
                                    <button class="btn btn-primary" value="提交" id="submit">提交
                                    </button>
                                </div>
                            </div>
                        </div>

                    </form>
                </div>
            </section>

        </div>
        <!-- 主体头部结束 -->


        <!--footer section start-->
        <footer>
            2021 &copy; Designed by JYQ.
        </footer>
        <!--footer section end-->


    </div>
    <!--主体结束：出去左侧导航栏所有-->
</section>
<!-- Placed js at the end of the document so the pages load faster -->
<script src="../../js/jquery-1.10.2.min.js"></script>
<script src="../../js/jquery-ui-1.9.2.custom.min.js"></script>
<script src="../../js/jquery-migrate-1.2.1.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/modernizr.min.js"></script>
<script src="../../js/jquery.nicescroll.js"></script>

<!--easy pie chart-->
<script src="../../js/easypiechart/jquery.easypiechart.js"></script>
<script src="../../js/easypiechart/easypiechart-init.js"></script>

<!--Sparkline Chart-->
<script src="../../js/sparkline/jquery.sparkline.js"></script>
<script src="../../js/sparkline/sparkline-init.js"></script>

<!--icheck -->
<script src="../../js/iCheck/jquery.icheck.js"></script>
<script src="../../js/icheck-init.js"></script>

<!--Morris Chart-->
<script src="../../js/morris-chart/morris.js"></script>
<script src="../../js/morris-chart/raphael-min.js"></script>


<!--common scripts for all pages-->
<script src="../../js/scripts.js"></script>

<!--Dashboard Charts-->
<script src="../../js/dashboard-chart-init.js"></script>

<!-- Part js for user -->

<script>
    //首先要判断该用户打卡情况

    /**
     * 本页面独有js
     */
    $(function () {


        //登录状态为已经登录时放行
        if (sessionStorage.getItem("epc_con_SignIn") == 201) {
            $("#mainSignIn").empty();
            $("#mainSignIn").append('<div class="alert alert-success">\n' +
                ' <strong>今日打卡已完成！</strong>\n' +
                '</div>');
        }

        //登录状态为未登录时拦截，定向到首页
        if (sessionStorage.getItem("login_epc_msg") == 202) {
            alert("请先登录！")
            $("#mainSignIn").empty();
            window.location.href = "/user/toIndex_epc";
        }


        //如果点击无症状，其他不能选择,并且把选择了的也取消
        $("#status_0").click(function () {
            if ($('#status_0').prop('checked') == true) {
                $("#status_1").prop('disabled', true);
                $("#status_2").prop('disabled', true);
                $("#status_3").prop('disabled', true);
                $("#status_4").prop('disabled', true);
                $("#status_5").prop('disabled', true);
                $("#status_6").prop('disabled', true);
                $("#status_1").prop('checked', false);
                $("#status_2").prop('checked', false);
                $("#status_3").prop('checked', false);
                $("#status_4").prop('checked', false);
                $("#status_5").prop('checked', false);
                $("#status_6").prop('checked', false);

            } else {
                $("#status_1").prop('disabled', false);
                $("#status_2").prop('disabled', false);
                $("#status_3").prop('disabled', false);
                $("#status_4").prop('disabled', false);
                $("#status_5").prop('disabled', false);
                $("#status_6").prop('disabled', false);
            }
        });

        //将名字显示到页面上
        $("#username_1").prop('value', sessionStorage.getItem("epc_name"));
        //若未登录，则不允许进入打卡页面
        if ($("#username_1").val() == '') {
            alert("请先登录！")
            window.location.href = '/user/toIndex_epc';
        }

        //获取体温值
        $("#temperature").keyup(function () {
            var num = parseFloat($("#temperature").val());
            if ((num > 35 && num < 42) || $("#temperature").val() == '') {
                window.sessionStorage.setItem("tem_judge", 'hefa');
                $("#effect_tem").remove();
            } else {
                window.sessionStorage.setItem("tem_judge", 'buhefa');
                htmladdOne = "";
                htmladdOne = '<span id="effect_tem" style="color: #ff0000">请输入35-42之间的有效字符！</span>';
                $("#effect_tem").remove();
                $("#temp").append(htmladdOne);
            }
        });

        //给地址置值，来触发键盘抬起事件
        $("#loc").prop('value', '辽宁省');

        //获取地址值
        $("#loc").keyup(function () {
            var num = parseInt($("#loc").val().trim().length);
            if ((num >= 3) || $("#loc").val() == '') {
                window.sessionStorage.setItem("loc_judge", 'hefa');
                $("#effect_loc").remove();
            } else {
                window.sessionStorage.setItem("loc_judge", 'buhefa');
                htmladdTwo = "";
                htmladdTwo = '<span id="effect_loc" style="color: #ff0000">请输入有效地址！</span>';
                $("#effect_loc").remove();
                $("#loc_div").append(htmladdTwo);
            }
        });

        //不选认责不让提交
        $("#submit").prop('disabled', true);
        $("#fuze").click(function () {
            if ($('#fuze').prop('checked') == true) {
                $("#submit").prop('disabled', false);
            } else {
                $("#submit").prop('disabled', true);
            }
        });

        $("#submit").click(function () {
            if ($("#temperature").prop('value') == '') {
                $("#temperature").focus();
            } else if ($("#loc").prop('value') == '') {
                $("#loc").focus();
            } else if ($("#status_0").prop('checked') == false && $("#status_1").prop('checked') == false && $("#status_2").prop('checked') == false &&
                $("#status_3").prop('checked') == false && $("#status_4").prop('checked') == false && $("#status_5").prop('checked') == false && $("#status_6").prop('checked') == false) {
                $("#status_0").prop('checked', true);
            } else if ($("#radio_status2").prop('checked') == false && $("#radio_status1").prop('checked') == false && $("#radio_status3").prop('checked') == false) {
                $("#radio_status2").prop('checked', true);
            } else if ((sessionStorage.getItem("tem_judge") == 'hefa') && (sessionStorage.getItem("loc_judge") == 'hefa')) {
                var symbol = '';
                if ($("#status_0").prop('checked') == true) {
                    symbol = $("#status_0").val();
                } else {
                    if ($("#status_1").prop('checked') == true) {
                        symbol += $("#status_1").val();
                        symbol += ',';
                    }
                    if ($("#status_2").prop('checked') == true) {
                        symbol += $("#status_2").val();
                    }
                    if ($("#status_3").prop('checked') == true) {
                        symbol += $("#status_3").val();
                        symbol += ',';
                    }
                    if ($("#status_4").prop('checked') == true) {
                        symbol += $("#status_4").val();
                        symbol += ',';
                    }
                    if ($("#status_5").prop('checked') == true) {
                        symbol += $("#status_5").val();
                        symbol += ',';
                    }
                    if ($("#status_6").prop('checked') == true) {
                        symbol += $("#status_6").val();
                        symbol += ',';
                    }
                }
                symbol = symbol.substr(0, symbol.length - 1);
                var radio = '';
                if ($("#radio_status1").prop("checked") == true) radio = $("#radio_status1").val();
                if ($("#radio_status2").prop("checked") == true) radio = $("#radio_status2").val();
                if ($("#radio_status3").prop("checked") == true) radio = $("#radio_status3").val();
                // 将所有信息添加到数据库中
                $.ajax({
                    url: "/userinfo/insertUserInfo",
                    type: "get",
                    data: {
                        "user_id": sessionStorage.getItem("epc_id"),
                        "user_name": sessionStorage.getItem("epc_name"),
                        "user_temperature": $("#temperature").val(),
                        "physical_condition": symbol,
                        "contact_condition": radio,
                        "user_loc": $("#loc").val()
                    },
                    success: function (result) {
                        if (result.code == 200) {
                            $("#mainSignIn").empty();
                            $("#mainSignIn").append('<div class="alert alert-success">\n' +
                                ' <strong>今日打卡已完成！</strong>\n' +
                                '</div>');
                            window.sessionStorage.setItem("epc_con_SignIn", "201");
                        }
                    },
                    error: function (result) {
                        alert("请先登录！")
                        location.reload();
                    }
                });
            }
        });

    });

    //检查是否打卡
    $(function () {
        $.ajax({
            url: "/user/selectCheckInById",
            type: "get",
            data: {"user_id": sessionStorage.getItem("epc_id")},
            success: function (result) {
                if (result.code == 200) {
                    $("#mainSignIn").empty();
                    $("#mainSignIn").append('<div class="alert alert-success">\n' +
                        ' <strong>今日打卡已完成！</strong>\n' +
                        '</div>');
                }
            }, error: function (result) {
                alert("请先登录！");
                window.location.href = "/user/toIndex_epc";
            }
        });
    });

    $(function () {
        /**
         * 登陆状态201
         */

        if (sessionStorage.getItem("login_epc_msg") == "201") {
            //首先清空节点
            $("#login_user").empty();
            //添加节点
            var htmladd = "";
            htmladd = '<a href="#" class="btn btn-default dropdown-toggle" data-toggle="dropdown">' +
                '<img src="../../images/photos/user-avatar.png" alt="" />' +
                sessionStorage.getItem("epc_name") +
                '<span class="caret"></span>' +
                '</a>' +
                '<ul class="dropdown-menu dropdown-menu-usermenu pull-right">' +
                '<li><a href="/user/toEpc_info"><i class="fa fa-user"></i>  个人简介</a></li>' +
                '<li><a href="#" onclick="signOut()" id="signOut"><i class="fa fa-sign-out"></i> 退出登录</a></li>' +
                '</ul>';
            $("#login_user").append(htmladd);
        }
        /**
         * 非登陆状态202
         */
        if (sessionStorage.getItem("login_epc_msg") == "202") {
            $("#login_user").empty();
            var htmlAdd = "";
            htmlAdd = '<a href="/user/toLogin" class="btn btn-default dropdown-toggle">' +
                '登&nbsp;&nbsp;录' +
                '<span class="glyphicon glyphicon-new-window"></span>' +
                '</a>';
            $("#login_user").append(htmlAdd);
        }


        /**
         *点击打卡记录的总操作
         * 在这个界面点击打卡记录：因为不登录无法进入打卡界面，相当于在打卡界面处拦截
         */

        $("#SignInRecords").click(function () {
            $("ul#ul_1 li").attr('class', '');
            $("ul#ul_2 li").attr('class', '');
            $("ul#ul_3 li").attr('class', '');
            $("ul#ul_4 li").attr('class', '');
            //触发一次点击事件

            $("ul#ul_1").children("li:eq(2)").attr('class', 'active');
            $.ajax({
                url: "/userinfo/selectSignInRecords",
                type: "get",
                data: {"user_id": sessionStorage.getItem("epc_id")},
                success: function (result) {
                    $("div#main").empty();
                    var htmlAddOne = '';
                    htmlAddOne = '<section class="panel">\n' +
                        '            <header class="panel-heading">\n' +
                        '                打卡记录\n' +
                        '            </header>\n' +
                        '            <table class="table" id="RecordTable">\n' +
                        '                <tr>\n' +
                        '                    <th>用户编号</th>\n' +
                        '                    <th>姓名</th>\n' +
                        '                    <th>温度</th>\n' +
                        '                    <th>身体状况</th>\n' +
                        '                    <th>接触情况</th>\n' +
                        '                    <th>地址</th>\n' +
                        '                    <th>提交时间</th>\n' +
                        '                </tr>\n' +
                        '            </table>\n' +
                        '        </section>';
                    $("div#main").append(htmlAddOne);
                    if (result.code == 200) {
                        $.each(result.extend.userInfos, function (index, item) {
                            var user_idTd = $("<td></td>").append(item.user_id);
                            var user_nameTd = $("<td></td>").append(item.user_name);
                            var user_temperatureTd = $("<td></td>").append(item.user_temperature);
                            var physical_conditionTd = $("<td></td>").append(item.physical_condition);
                            var contact_conditionTd = $("<td></td>").append(item.contact_condition);
                            var user_locTd = $("<td></td>").append(item.user_loc);
                            var operate_timeTd = $("<td></td>").append(item.operate_time);
                            $("<tr></tr>")
                                .append(user_idTd)
                                .append(user_nameTd)
                                .append(user_temperatureTd)
                                .append(physical_conditionTd)
                                .append(contact_conditionTd)
                                .append(user_locTd)
                                .append(operate_timeTd)
                                .appendTo("#RecordTable tbody");
                        });
                    } else {
                        $("div#main").append("暂无打卡记录");
                    }
                }, error: function (result) {
                    alert("请先登录");
                    window.location.href = "/user/toIndex_epc";
                }
            });
        });
    });


    //登出
    function signOut() {
        $.ajax({
            url: "/user/toSignOut",
            type: "get",
            data: {},
            success: function (result) {
                if (result.code == 200) {
                    //非登录状态
                    window.sessionStorage.setItem("login_epc_msg", "202");
                    //id置空
                    window.sessionStorage.setItem("epc_id", '');
                    window.location.href = '/user/toIndex_epc';
                }
            },
            error: function (result) {
                alert("error");
            }
        });
    }


</script>
</body>
</html>
