<!DOCTYPE html>
<html lang="zh">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="keywords"
          content="admin, dashboard, bootstrap, template, flat, modern, theme, responsive, fluid, retina, backend, html5, css, css3">
    <meta name="description" content="">
    <meta name="author" content="ThemeBucket">

    <title>辽科大疫情防控平台</title>
    <link rel="shortcut icon" href="../../img/logo.ico"/>

    <!--icheck 不重要-->
    <link href="../../js/iCheck/skins/minimal/minimal.css" rel="stylesheet">
    <link href="../../js/iCheck/skins/square/square.css" rel="stylesheet">
    <link href="../../js/iCheck/skins/square/red.css" rel="stylesheet">
    <link href="../../js/iCheck/skins/square/blue.css" rel="stylesheet">

    <!--dashboard calendar不重要-->
    <link href="../../css/clndr.css" rel="stylesheet">

    <!--Morris Chart CSS 不重要-->
    <link rel="stylesheet" href="../../js/morris-chart/morris.css">

    <!--common重要-->
    <link href="../../css/style_user.css" rel="stylesheet">
    <!-- 不重要 -->
    <link href="../../css/style-responsive.css" rel="stylesheet">
</head>

<body class="sticky-header">

<section>

    <div class="left-side sticky-left-side">

        <!--logo and iconic logo 开始-->
        <div class="logo">
            <a href="/user/toIndex_user"><img src="../../images/logo.png" alt=""></a>
        </div>

        <div class="logo-icon text-center">
            <a href="/user/toIndex_user"><img src="../../images/logo_icon.png" alt=""></a>
        </div>
        <!--logo and iconic logo 结束-->

        <!--左侧导航栏开始-->
        <div class="left-side-inner">

            <ul class="nav nav-pills nav-stacked custom-nav" id="ul_0">
                <li><a href="/user/toIndex_user"><i class="fa fa-home"></i> <span
                        id="zhuye">主页</span></a></li>

                <li class="menu-list"><a href=""><i class="fa fa-laptop"></i> <span id="daka">打卡</span></a>
                    <ul class="sub-menu-list" id="ul_1">
                        <li><a href="/user/toUser_signIn"> 今日打卡</a></li>
                        <li><a href="#" id="SignInRecords"> 打卡记录</a></li>
                    </ul>
                </li>

                <li class="menu-list"><a href=""><i class="fa fa-book"></i> <span>我的校园</span></a>
                    <ul class="sub-menu-list" id="ul_2">
                        <li><a href="/user/toUser_collect"> 普通收集</a></li>
                        <li><a href="/user/toUser_applyForEpc"> 防疫员申请</a></li>
                    </ul>
                </li>

                <li class="menu-list"><a href="fontawesome.html"><i class="fa fa-bullhorn"></i> <span>预约项目</span></a>
                    <ul class="sub-menu-list" id="ul_3">
                        <li><a href="/user/toUser_appointNa"> 核酸检测预约</a></li>
                        <li><a href="/user/toUser_appointVac"> 接种疫苗预约</a></li>
                    </ul>
                </li>

                <li class="active"><a href="/user/toUser_message"><i class="fa fa-envelope"></i> <span
                        id="liuyan">留言</span></a>

                </li>

                <li class="menu-list"><a href=""><i class="fa fa-cogs"></i> <span>账号管理</span></a>
                    <ul class="sub-menu-list" id="ul_4">
                        <li><a href="/user/toUser_info"> 个人信息管理</a></li>
                        <li><a href="/user/toUser_repass"> 修改密码</a></li>
                    </ul>
                </li>
            </ul>


        </div>
        <!--左侧导航栏结束-->
    </div>

    <!-- 主体开始：除去左侧导航栏所有-->
    <div class="main-content">

        <!-- 上方导航栏开始 -->
        <div class="header-section">

            <!--左侧导航栏伸展开始-->
            <a class="toggle-btn"><i class="fa fa-bars"></i></a>
            <!--左侧导航栏伸展结束-->

            <!--搜索框开始 action中跳转地址！-->
            <form class="searchform" action="index.html" method="post">
                <input type="text" class="form-control" name="keyword" placeholder="Search here..."/>
            </form>
            <!--搜索框结束-->

            <!-- 上方导航栏右侧通知 + 人物 开始-->
            <div class="menu-right">
                <ul class="notification-menu">
                    <!-- 上侧导航栏task开始 -->
                    <li>
                        <a href="#" class="btn btn-default dropdown-toggle info-number" data-toggle="dropdown">
                            <i class="fa fa-tasks"></i>
                            <span class="badge">1</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-head pull-right">
                            <h5 class="title">你有 1 个挂起任务</h5>
                            <ul class="dropdown-list user-list">
                                <li class="new">
                                    <a href="#">
                                        <div class="task-info">
                                            <div>Database update</div>
                                        </div>
                                        <div class="progress progress-striped">
                                            <div style="width: 40%" aria-valuemax="100" aria-valuemin="0"
                                                 aria-valuenow="40" role="progressbar"
                                                 class="progress-bar progress-bar-warning">
                                                <span class="">40%</span>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="new"><a href="">查看所有任务</a></li>
                            </ul>
                        </div>
                    </li>
                    <!-- 上侧导航栏task结束 -->

                    <!-- 上方导航栏Email开始 -->
                    <li>
                        <a href="#" class="btn btn-default dropdown-toggle info-number" data-toggle="dropdown">
                            <i class="fa fa-envelope-o"></i>
                            <span class="badge">1</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-head pull-right">
                            <h5 class="title">您有 1 封邮件 </h5>
                            <ul class="dropdown-list normal-list">
                                <li class="new">
                                    <a href="">
                                        <span class="thumb"><img src="../../images/photos/user1.png" alt=""/></span>
                                        <span class="desc">
                                          <span class="name">John Doe <span
                                                  class="badge badge-success">new</span></span>
                                          <span class="msg">Lorem ipsum dolor sit amet...</span>
                                        </span>
                                    </a>
                                </li>

                            </ul>
                        </div>
                    </li>
                    <!-- 上方导航栏Email结束 -->

                    <!-- 上方导航栏铃铛提醒开始 -->
                    <li>
                        <a href="#" class="btn btn-default dropdown-toggle info-number" data-toggle="dropdown">
                            <i class="fa fa-bell-o"></i>
                            <span class="badge">1</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-head pull-right">
                            <h5 class="title">注意事项</h5>
                            <ul class="dropdown-list normal-list">
                                <li class="new">
                                    <a href="">
                                        <span class="label label-danger"><i class="fa fa-bolt"></i></span>
                                        <span class="name">Server #1 overloaded.  </span>
                                        <em class="small">34 mins</em>
                                    </a>
                                </li>

                                <li class="new"><a href="">查看所有注意事项</a></li>
                            </ul>
                        </div>
                    </li>
                    <!-- 上方导航栏铃铛提醒结束 -->

                    <!-- 上方导航栏User开始 -->
                    <li id="login_user">
                        <a href="/user/toLogin" class="btn btn-default dropdown-toggle">
                            登&nbsp;&nbsp;录
                            <span class="glyphicon glyphicon-new-window"></span>
                        </a>
                    </li>
                    <!-- 上方导航栏User结束 -->

                </ul>
            </div>
            <!--上方导航栏右侧通知 + 人物结束 -->
        </div>
        <!-- 上方导航栏结束-->


        <!-- 主体头部开始 -->

        <div class="page-heading" id="xsly">
            <h3>
                学生留言
            </h3>
            <a class="btn btn-success" data-toggle="modal" data-target="#insertMessage">留言</a>

        </div>
        <!-- 主体头部结束 -->

        <!-- 主体中心开始 -->
        <div class="wrapper" id="xszx">
            <div class="row">
                <div class="col-md-12">
                    <!--statistics start-->
                    <div class="row state-overview" id="message">

                    </div>
                </div>
            </div>
        </div>
        <div class="page-heading" id="main">

        </div>
        <!-- 主体中心结束 -->
        <!--footer section start-->
        <footer>
            2021 &copy; Designed by JYQ.
        </footer>
        <!--footer section end-->


    </div>
    <!--主体结束：出去左侧导航栏所有-->
</section>

<!--新建留言开始-->
<div class="modal fade" id="insertMessage" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <form action="" method="post">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">新增留言</h4>
                </div>
                <div class="modal-body">
                    <table class="table" style="margin-bottom:0px;">
                        <thead>
                        <tr></tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td wdith="20%">留言内容</td>
                            <td width="80%"><textarea class="form-control" id="message_textarea" cols="30" rows="5"
                                                      maxlength="10" style="resize:none"></textarea></td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="sub_message">提交</button>
                    <button type="button" class="btn btn-default" id="close_message" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </form>
    </div>
</div>
<!--新建留言结束-->


<!-- Placed js at the end of the document so the pages load faster -->
<script src="../../js/jquery-1.10.2.min.js"></script>
<script src="../../js/jquery-ui-1.9.2.custom.min.js"></script>
<script src="../../js/jquery-migrate-1.2.1.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/modernizr.min.js"></script>
<script src="../../js/jquery.nicescroll.js"></script>

<!--easy pie chart-->
<script src="../../js/easypiechart/jquery.easypiechart.js"></script>
<script src="../../js/easypiechart/easypiechart-init.js"></script>

<!--Sparkline Chart-->
<script src="../../js/sparkline/jquery.sparkline.js"></script>
<script src="../../js/sparkline/sparkline-init.js"></script>

<!--icheck -->
<script src="../../js/iCheck/jquery.icheck.js"></script>
<script src="../../js/icheck-init.js"></script>

<!-- jQuery Flot Chart-->
<script src="../../js/flot-chart/jquery.flot.js"></script>
<script src="../../js/flot-chart/jquery.flot.tooltip.js"></script>
<script src="../../js/flot-chart/jquery.flot.resize.js"></script>


<!--Morris Chart-->
<script src="../../js/morris-chart/morris.js"></script>
<script src="../../js/morris-chart/raphael-min.js"></script>

<!--Calendar-->
<script src="../../js/calendar/clndr.js"></script>
<script src="../../js/calendar/evnt.calendar.init.js"></script>
<script src="../../js/calendar/moment-2.2.1.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>

<!--common scripts for all pages-->
<script src="../../js/scripts.js"></script>

<!--Dashboard Charts-->
<script src="../../js/dashboard-chart-init.js"></script>

<!-- All js for user -->
<script>

    $(function () {
        //请先登录，登录拦截
        if (sessionStorage.getItem('user_name') == '' || sessionStorage.getItem('user_name') == null) {
            alert("请先登录！");
            $("#main_userInfo").empty();
            window.location.href = '/user/toIndex_user';
        }

        //查看留言select
        $.ajax({
            url: "/message/selectUserMessage",
            type: "get",
            success: function (result) {
                if (result.code == 200) {
                    $.each(result.extend.messageList, function (index, item) {
                        var html_add_1 = '<div class="col-md-6 col-xs-12 col-sm-6">\n' +
                            '                            <div class="panel blue">\n' +
                            '                                <div>\n' +
                            '                                    <i class="fa fa-tags"></i>\n' +
                            '                                </div>\n' +
                            '                                <div id="message_content">' + item.message_content + '</div>\n' +
                            '                                <div class="title" id="user_name">留言人:' + item.user_name + '</div>\n' +
                            '                            </div>\n' +
                            '                        </div>';
                        $("#message").append(html_add_1);
                    });
                }
                if (result.code == 100) {
                    $("#message").append('<div class="alert alert-success">\n' +
                        ' <strong>暂无留言</strong>\n' +
                        '</div>');
                }
            }, error: function (result) {
                alert("error!");
                $("#message_textarea").val('');

            }
        });

        //新增留言
        $("#sub_message").click(function () {
            $("#message_textarea").val();
            $.ajax({
                url: "/message/insertMessage",
                type: "get",
                data: {
                    "message_content": $("#message_textarea").val(),
                    "user_name": sessionStorage.getItem("user_name"),
                    "user_id": sessionStorage.getItem("user_id")
                }, success: function (result) {
                    alert("留言成功！");
                    $("#close_message").click();
                    $("#message_textarea").val('');
                    $("#liuyan").click();
                }, error: function (result) {
                    alert("error!");
                }
            });
        });
    });


    //在本页点击查看打卡记录对本页面的具体操作
    $(function () {
        $("#SignInRecords").click(function () {
            $("ul#ul_0").children("li:eq(4)").attr('class', '');
        });
    });

    $(function () {

        /**
         * 登陆状态201
         */

        if (sessionStorage.getItem("login_msg") == "201") {
            //首先清空节点
            $("#login_user").empty();
            //添加节点
            var htmladd = "";
            htmladd = '<a href="#" class="btn btn-default dropdown-toggle" data-toggle="dropdown">' +
                '<img src="../../images/photos/user-avatar.png" alt="" />' +
                sessionStorage.getItem("user_name") +
                '<span class="caret"></span>' +
                '</a>' +
                '<ul class="dropdown-menu dropdown-menu-usermenu pull-right">' +
                '<li><a href="/user/toUser_info"><i class="fa fa-user"></i>  个人简介</a></li>' +
                '<li><a href="#" onclick="signOut()" id="signOut"><i class="fa fa-sign-out"></i> 退出登录</a></li>' +
                '</ul>';
            $("#login_user").append(htmladd);
        }
        /**
         * 非登陆状态202
         */
        if (sessionStorage.getItem("login_msg") == "202") {
            $("#login_user").empty();
            var htmlAdd = "";
            htmlAdd = '<a href="/user/toLogin" class="btn btn-default dropdown-toggle">' +
                '登&nbsp;&nbsp;录' +
                '<span class="glyphicon glyphicon-new-window"></span>' +
                '</a>';
            $("#login_user").append(htmlAdd);
        }

        /**
         *点击打卡记录的总操作
         * 在不同的页面中，有对点击操作具体增加了一些操作
         */

        $("#SignInRecords").click(function () {
            $("ul#ul_1 li").attr('class', '');
            $("ul#ul_2 li").attr('class', '');
            $("ul#ul_3 li").attr('class', '');
            $("ul#ul_4 li").attr('class', '');
            //触发一次点击事件

            $("ul#ul_1").children("li:eq(2)").attr('class', 'active');
            $.ajax({
                url: "/userinfo/selectSignInRecords",
                type: "get",
                data: {"user_id": sessionStorage.getItem("user_id")},
                success: function (result) {
                    $("div#main").empty();
                    //remove本页面的留言信息
                    $("#xszx").remove();
                    $("#xsly").remove();
                    var htmlAddOne = '';
                    htmlAddOne = '<section class="panel">\n' +
                        '            <header class="panel-heading">\n' +
                        '                打卡记录\n' +
                        '            </header>\n' +
                        '            <table class="table" id="RecordTable">\n' +
                        '                <tr>\n' +
                        '                    <th>用户编号</th>\n' +
                        '                    <th>姓名</th>\n' +
                        '                    <th>温度</th>\n' +
                        '                    <th>身体状况</th>\n' +
                        '                    <th>接触情况</th>\n' +
                        '                    <th>地址</th>\n' +
                        '                    <th>提交时间</th>\n' +
                        '                </tr>\n' +
                        '            </table>\n' +
                        '        </section>';
                    $("div#main").append(htmlAddOne);
                    if (result.code == 200) {
                        $.each(result.extend.userInfos, function (index, item) {
                            var user_idTd = $("<td></td>").append(item.user_id);
                            var user_nameTd = $("<td></td>").append(item.user_name);
                            var user_temperatureTd = $("<td></td>").append(item.user_temperature);
                            var physical_conditionTd = $("<td></td>").append(item.physical_condition);
                            var contact_conditionTd = $("<td></td>").append(item.contact_condition);
                            var user_locTd = $("<td></td>").append(item.user_loc);
                            var operate_timeTd = $("<td></td>").append(item.operate_time);
                            $("<tr></tr>")
                                .append(user_idTd)
                                .append(user_nameTd)
                                .append(user_temperatureTd)
                                .append(physical_conditionTd)
                                .append(contact_conditionTd)
                                .append(user_locTd)
                                .append(operate_timeTd)
                                .appendTo("#RecordTable tbody");
                        });
                    } else {
                        $("div#main").append("暂无打卡记录");
                    }
                }, error: function (result) {
                    alert("请先登录");
                    location.reload();
                }
            });
        });

        /*
        //点击每一个项目时的未登录拦截
        if (sessionStorage.getItem("login_msg") == 202
        || sessionStorage.getItem("user_id") == null
        || sessionStorage.getItem("user_id") == '') {
            alert("请先登录！")
            window.location.href = "/user/toIndex_user";
        }*/
    });


    //登出
    function signOut() {
        $.ajax({
            url: "/user/toSignOut",
            type: "get",
            data: {},
            success: function (result) {
                if (result.code == 200) {
                    //非登录状态
                    window.sessionStorage.setItem("login_msg", "202");
                    //id置空
                    window.sessionStorage.setItem("user_id", '');
                    // sessionStorage.removeItem("user_id");
                    window.location.href = '/user/toIndex_user';
                }
            },
            error: function (result) {
                alert("error");
            }
        });
    }


</script>
</body>
</html>
